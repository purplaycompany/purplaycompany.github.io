<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="./css/style.css" />
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">
    <title>영화제 홈</title>
</head>
<body>
    <div class="mobile-container">
        <section class="header-area">
            <nav class="top-area wrapper">
                <a class="back" onclick="history.back();">
                    <img src="/img/back.png" alt="뒤로 가기">
                </a>
                <span>티켓부스</span>
                <div class="search-notice">
                    <button>🔍</button>
                </div>
            </nav>
        </section>
        <section class="off-main">
            <div class="off-movie-wrapper light">
                <section class="off-select-menu">
                    <form action="">
                        <label for="off-select"></label>
                        <select name="off-select" id="off-select">
                            <option value="">전체 티켓</option>
                            <option value="">영화제1</option>
                            <option value="">영화제2</option>
                            <option value="">영화제3</option>
                            <option value="">영화제4</option>
                        </select>
                    </form>
                    <img src="./img/down.png" alt="더보기" onclick="">
                </section>
                <section class="off-user-guide">
                    <h4>온라인 상영관 이용 안내</h4>
                    <p class="close">관람 가격: 단편 2000퍼니 / 장편 6,000퍼니<br>상영 기간: 2023.06.26 00:00 ~07.09 24:00 <br>Lorem ipsum dolor sit amet consectetur adipisicing elit. Aliquid neque omnis, nemo repellat amet quia ducimus perferendis libero cumque? Laborum, dolorem harum sequi suscipit consectetur aliquam iusto illo minima provident.</p>
                    <div class="wrapper">
                        <button class="guide-more">
                            <img src="./img/down.png" alt="더보기">
                        </button>
                    </div>
                </section>
                <section class="search-area wrapper">
                    <input type="text">
                    <button type="submit">🔍</button>
                </section>
                <section class="off-ticket-area">
                    <form action="submit">
                        <article class="off-ticket wrapper" id="tkid0">
                            <input type="checkbox" name="ticket-option">
                            <img src="https://via.placeholder.com/200x200" alt="티켓대표이미지">
                            <div class="ticket-info">
                                <h4 class="ticket-section">섹션 이름1</h4>
                                <div class="wrapper">
                                    <span class="ticket-rate">15</span>
                                    <h4 class="ticket-title">영화 제목1</h4>
                                </div>
                                <div class="wrapper">
                                    <span class="ticket-count">잔여 200매</span>
                                    <span class="ticket-price">3000</span>
                                    <span>퍼니</span>
                                </div>
                            </div>
                        </article>
                        <article class="off-ticket wrapper" id="tkid1">
                            <input type="checkbox" name="ticket-option">
                            <img src="https://via.placeholder.com/200x200" alt="티켓대표이미지">
                            <div class="ticket-info">
                                <h4 class="ticket-section">섹션 이름2</h4>
                                <div class="wrapper">
                                    <span class="ticket-rate">15</span>
                                    <h4 class="ticket-title">영화 제목2</h4>
                                </div>
                                <div class="wrapper">
                                    <span class="ticket-count">잔여 200매</span>
                                    <span class="ticket-price">2500</span>
                                    <span>퍼니</span>
                                </div>
                            </div>
                        </article>
                        <article class="off-ticket wrapper" id="tkid2">
                            <input type="checkbox" name="ticket-option">
                            <img src="https://via.placeholder.com/200x200" alt="티켓대표이미지">
                            <div class="ticket-info">
                                <h4 class="ticket-section">섹션 이름3</h4>
                                <div class="wrapper">
                                    <span class="ticket-rate">15</span>
                                    <h4 class="ticket-title">영화 제목3</h4>
                                </div>
                                <div class="wrapper">
                                    <span class="ticket-count">잔여 200매</span>
                                    <span class="ticket-price">3000</span>
                                    <span>퍼니</span>
                                </div>
                            </div>
                        </article>
                        <article class="off-ticket wrapper" id="tkid3">
                            <input type="checkbox" name="ticket-option">
                            <img src="https://via.placeholder.com/200x200" alt="티켓대표이미지">
                            <div class="ticket-info">
                                <h4 class="ticket-section">섹션 이름4</h4>
                                <div class="wrapper">
                                    <span class="ticket-rate">15</span>
                                    <h4 class="ticket-title">영화 제목4</h4>
                                </div>
                                <div class="wrapper">
                                    <span class="ticket-count">잔여 200매</span>
                                    <span class="ticket-price">3000</span>
                                    <span>퍼니</span>
                                </div>
                            </div>
                        </article>
                        <article class="off-ticket wrapper" id="tkid4">
                            <input type="checkbox" name="ticket-option">
                            <img src="https://via.placeholder.com/200x200" alt="티켓대표이미지">
                            <div class="ticket-info">
                                <h4 class="ticket-section">섹션 이름5</h4>
                                <div class="wrapper">
                                    <span class="ticket-rate">15</span>
                                    <h4 class="ticket-title">영화 제목5</h4>
                                </div>
                                <div class="wrapper">
                                    <span class="ticket-count">잔여 200매</span>
                                    <span class="ticket-price">3000</span>
                                    <span>퍼니</span>
                                </div>
                            </div>
                        </article>
                        <article class="off-ticket wrapper" id="tkid5">
                            <input type="checkbox">
                            <img src="https://via.placeholder.com/200x200" alt="티켓대표이미지">
                            <div class="ticket-info">
                                <h4 class="ticket-section">섹션 이름</h4>
                                <div class="wrapper">
                                    <span class="ticket-rate">15</span>
                                    <h4 class="ticket-title">영화 제목</h4>
                                </div>
                                <div class="wrapper">
                                    <span class="ticket-count">잔여 200매</span>
                                    <span class="ticket-price">3000</span>
                                    <span>퍼니</span>
                                </div>
                            </div>
                        </article>
                        <article class="off-ticket wrapper" id="tkid6">
                            <input type="checkbox">
                            <img src="https://via.placeholder.com/200x200" alt="티켓대표이미지">
                            <div class="ticket-info">
                                <h4 class="ticket-section">섹션 이름</h4>
                                <div class="wrapper">
                                    <span class="ticket-rate">15</span>
                                    <h4 class="ticket-title">영화 제목</h4>
                                </div>
                                <div class="wrapper">
                                    <span class="ticket-count">잔여 200매</span>
                                    <span class="ticket-price">3000</span>
                                    <span>퍼니</span>
                                </div>
                            </div>
                        </article>
                        <article class="off-ticket wrapper" id="tkid7">
                            <input type="checkbox">
                            <img src="https://via.placeholder.com/200x200" alt="티켓대표이미지">
                            <div class="ticket-info">
                                <h4 class="ticket-section">섹션 이름</h4>
                                <div class="wrapper">
                                    <span class="ticket-rate">15</span>
                                    <h4 class="ticket-title">영화 제목</h4>
                                </div>
                                <div class="wrapper">
                                    <span class="ticket-count">잔여 200매</span>
                                    <span class="ticket-price">3000</span>
                                    <span>퍼니</span>
                                </div>
                            </div>
                        </article>
                        <article class="off-ticket wrapper" id="tkid8">
                            <input type="checkbox">
                            <img src="https://via.placeholder.com/200x200" alt="티켓대표이미지">
                            <div class="ticket-info">
                                <h4 class="ticket-section">섹션 이름</h4>
                                <div class="wrapper">
                                    <span class="ticket-rate">15</span>
                                    <h4 class="ticket-title">영화 제목</h4>
                                </div>
                                <div class="wrapper">
                                    <span class="ticket-count">잔여 200매</span>
                                    <span class="ticket-price">3000</span>
                                    <span>퍼니</span>
                                </div>
                            </div>
                        </article>
                        <article class="off-ticket wrapper" id="tkid9">
                            <input type="checkbox">
                            <img src="https://via.placeholder.com/200x200" alt="티켓대표이미지">
                            <div class="ticket-info">
                                <h4 class="ticket-section">섹션 이름</h4>
                                <div class="wrapper">
                                    <span class="ticket-rate">15</span>
                                    <h4 class="ticket-title">영화 제목</h4>
                                </div>
                                <div class="wrapper">
                                    <span class="ticket-count">잔여 200매</span>
                                    <span class="ticket-price">3000</span>
                                    <span>퍼니</span>
                                </div>
                            </div>
                        </article>
                        <article class="off-ticket wrapper" id="tkid10">
                            <input type="checkbox">
                            <img src="https://via.placeholder.com/200x200" alt="티켓대표이미지">
                            <div class="ticket-info">
                                <h4 class="ticket-section">섹션 이름</h4>
                                <div class="wrapper">
                                    <span class="ticket-rate">15</span>
                                    <h4 class="ticket-title">영화 제목</h4>
                                </div>
                                <div class="wrapper">
                                    <span class="ticket-count">잔여 200매</span>
                                    <span class="ticket-price">3000</span>
                                    <span>퍼니</span>
                                </div>
                            </div>
                        </article>
                        <article class="off-ticket wrapper" id="tkid11">
                            <input type="checkbox">
                            <img src="https://via.placeholder.com/200x200" alt="티켓대표이미지">
                            <div class="ticket-info">
                                <h4 class="ticket-section">섹션 이름</h4>
                                <div class="wrapper">
                                    <span class="ticket-rate">15</span>
                                    <h4 class="ticket-title">영화 제목</h4>
                                </div>
                                <div class="wrapper">
                                    <span class="ticket-count">잔여 200매</span>
                                    <span class="ticket-price">3000</span>
                                    <span>퍼니</span>
                                </div>
                            </div>
                        </article>
                    </form>
                </section>
            </div>
        </section>
        <section class="bottom-area">
            <div class="ticket-receipt">
                <div class="selected-ticket-list">
                    
                </div>
                <div class="ticket-total wrapper">
                    <span>합계</span>
                    <div>
                        <span class="total-count">0</span>
                        <span>편</span>
                    </div>
                    <div>
                        <span class="total-price">0</span>
                        <span>퍼니</span>
                    </div>
                </div>
                <button class="get-ticket">
                    예매하기
                </button>
            </div>
        </section>
    </div>
</body>
<script>
    const $userGuideMoreBtn = document.querySelector('.guide-more');
    const $getTktBtn = document.querySelector('.get-ticket');
    const $selectedTkt = document.querySelectorAll('input[name=ticket-option]');
    const $ticketPrice = document.querySelectorAll('.ticket-price');

    let $tktList = document.querySelector('.off-ticket-area');
    let $selectedTktList = document.querySelector('.selected-ticket-list');
    let $selectedTktCnt = document.querySelector('.total-count');
    let $selectedTktPrice = document.querySelector('.total-price');
    let $selectedTktDeleteBtn = '';
    let $userGuideTxt = document.querySelector('.off-user-guide>p');
    console.log($userGuideMoreBtn);

    let totalTktCnt = 0;
    let totalTktPrice = 0;

    $ticketPrice.forEach(price => {
        let priceNum = Number(price.innerText).toLocaleString();
        price.innerText = priceNum;
    })

    $selectedTkt.forEach(checkbox => {checkbox.addEventListener('click', () => {
        selectedTkt = checkbox.closest('.off-ticket');
        selectedTkt.classList.toggle('selected');

        selectedTktId = selectedTkt.getAttribute('id');
        selectedTktName = selectedTkt.querySelector('.ticket-section');
        selectedTktTitle = selectedTkt.querySelector('.ticket-title');
        selectedTktPrice = selectedTkt.querySelector('.ticket-price');

        if(selectedTkt.classList.contains('selected')) {
            checkbox.checked = true;
            $selectedTktList.innerHTML += `
                <article class="selected-ticket-item wrapper" id="` + selectedTktId + `">
                    <span class="off-name">` + selectedTktName.innerText + `</span>
                    <span class="ticket-title">` + selectedTktTitle.innerText + `</span>
                    <span class="ticket-price">` + selectedTktPrice.innerText + `</span><span>퍼니</span>
                    <span class="ticket-cancel"></span>
                </article>
            `;

            $selectedTktDeleteBtn = document.querySelectorAll('.ticket-cancel');
            totalTktCnt++;
            totalTktPrice += Number(selectedTktPrice.innerText.replace(/,/g, ""));
            $selectedTktCnt.innerText = totalTktCnt;
            $selectedTktPrice.innerText = totalTktPrice.toLocaleString();
            deleteSelectedTkt();
        } else {
            checkbox.checked = false;
            let findString = 'article[id=' + selectedTktId + ']';
            cancelledTkt = $selectedTktList.querySelector(findString);
            $selectedTktList.removeChild(cancelledTkt);
            $selectedTktDeleteBtn = document.querySelectorAll('.ticket-cancel');
            totalTktCnt--;
            totalTktPrice -= Number(selectedTktPrice.innerText.replace(/,/g, ""));
            $selectedTktCnt.innerText = totalTktCnt;
            $selectedTktPrice.innerText = totalTktPrice.toLocaleString();
        }
    })
    });

    $userGuideMoreBtn.addEventListener('click', () => {
        if($userGuideTxt.style.height === 'auto') {
            $userGuideTxt.style.height = '2rem';
            $userGuideMoreBtn.querySelector('img').style.transform = 'rotate(180deg)';
    
        } else {
            $userGuideTxt.style.height = 'auto';
            $userGuideMoreBtn.querySelector('img').style.transform = 'rotate(180deg)';    
        }
    })
    $getTktBtn.addEventListener('click', () => {
        location.href = "./off-payment.html";
    });

    const deleteSelectedTkt = () => {
        $selectedTktDeleteBtn = document.querySelectorAll('.ticket-cancel');
        $selectedTktList = document.querySelector('.selected-ticket-list');

        console.log($selectedTktDeleteBtn)
        console.log($selectedTktList);

        $selectedTktDeleteBtn.forEach(btn => {btn.addEventListener('click', () => {
            let deletedTkt = btn.parentElement;
            let deletedTktPrice = deletedTkt.querySelector('.ticket-price');
            let deletedTktId = deletedTkt.getAttribute('id');
            console.log(deletedTkt);
            $selectedTktList.removeChild(deletedTkt);
            $selectedTktDeleteBtn = document.querySelectorAll('.ticket-cancel');
            totalTktCnt--;
            totalTktPrice -= Number(deletedTktPrice.innerText.replace(/,/g, ""));
            $selectedTktCnt.innerText = totalTktCnt;
            $selectedTktPrice.innerText = totalTktPrice.toLocaleString();

            let findString = 'article[id=' + deletedTktId + ']';
            let uncheckedTkt = $tktList.querySelector(findString);
            uncheckedTkt.classList.toggle('selected');
            uncheckedChkBox = uncheckedTkt.querySelector('input');
            uncheckedChkBox.checked = false;
    })

    });
    };

    const getSelectedTktList = () => {
        let $list = $tktList.querySelectorAll('input[checked=true]');
        console.log($list);
        $list.forEach(item => {
            item.checked = true;
            $selectedTktList.innerHTML += `
                <article class="selected-ticket-item wrapper" id="` + selectedTktId + `">
                    <span class="off-name">` + selectedTktName.innerText + `</span>
                    <span class="ticket-title">` + selectedTktTitle.innerText + `</span>
                    <span class="ticket-price">` + selectedTktPrice.innerText + `</span><span>퍼니</span>
                    <span class="ticket-cancel"></span>
                </article>
            `;

            $selectedTktDeleteBtn = document.querySelectorAll('.ticket-cancel');
            totalTktCnt++;
            totalTktPrice += Number(selectedTktPrice.innerText.replace(/,/g, ""));
            $selectedTktCnt.innerText = totalTktCnt;
            $selectedTktPrice.innerText = totalTktPrice.toLocaleString();
            deleteSelectedTkt();
        });
        console.log('eee');
    }

    const init = () => {
        window.addEventListener('DOMContentLoaded', () => {
            getSelectedTktList();
        });
    };

    init();
    getSelectedTktList();
</script>
</html>